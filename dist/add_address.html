<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="max-age=7200" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="css/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="css/add_address.css" />
    <link rel="stylesheet" href="lib/layer/layer.css">
    <link rel="stylesheet" href="lib/layui/css/layui.mobile.css">
    <script src="lib/jquery/jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/rem/rem.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/iscroll/iscroll-probe.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/layer/layer.js"></script>
    <script src="lib/layui/layui.js"></script>
    <script src="lib/layui/layui.all.js"></script>
    <script src="js/common.js" type="text/javascript" charset="utf-8"></script>
    <title></title>
</head>

<body>
    <!--头部-->
    <header>
        <i class="iconfont">&#xe602;</i>
        <p class="title">
            新增地址
        </p>
    </header>
    <!--新增地址-->
    <div id="main">
        <p class="add_style user">
            <span class="add_title">收货人</span>
            <input class="user-name" type="text" placeholder="请输入联系人姓名">
        </p>
        <p class="add_style tell">
            <span class="add_title">手机号</span>
            <input class="user-name tell-info" type="number" placeholder="请输入手机号码">
        </p>
        <p class="add_style postcode">
            <span class="add_title">邮编号码</span>
            <input class="user-name" type="number" placeholder="请输入邮政编码（选填）">
        </p>
        <div class="add_style select">
            <span class="add_title">省市区</span>
            <p class="user-name selectList">
                <select id="cmbProvince" name="cmbProvince">

            </select>
                <i class="cmbProvince-icon iconfont">&#xe603;</i>
                <select id="cmbCity" name="cmbCity">

            </select>
                <i class="cmbCity-icon iconfont">&#xe603;</i>
                <select id="cmbArea" name="cmbArea">

            </select>
                <i class="cmbArea-icon iconfont">&#xe603;</i>
            </p>
        </div>
        <p class="add_style address">
            <span class="add_title">详细地址</span>
            <input class="user-name add-info" type="text" placeholder="请输入详细地址">
        </p>
        <div class="info">
            为了保证您能顺利到收到我们产品，请准确填写联系人、手机号和邮寄地址，谢谢您的配合。
        </div>
    </div>
    <!--保存地址-->
    <footer>
        保存地址
    </footer>
</body>
<script>
    $(function() {
        //点击返回
        $('header').on('touchend', '.iconfont', function() {
                window.history.go(-1);
            })
            //判断收货人 非空
        function verifyUser() {
            if ($('.user-name').val() == '') {
                $('.user').addClass('active');
                layer.msg('收货人姓名不能为空');
                return false;
            } else {
                $('.user').removeClass('active');
                return true;
            }
        }
        //验证电话号码
        function verifyTell() {
            var ExpTell = /^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/;
            if ($('.tell-info').val().match(ExpTell)) {
                $('.tell').removeClass('active');
                return true;
            } else {
                $('.tell').addClass('active')
                layer.msg('请填写正确的手机号');
                return false;
            }
        }

        //判断地址非空
        function verifyAddr() {
            if ($('.add-info').val() == '') {
                $('.address').addClass('active')
                layer.msg('详细地址不能为空');
                return false;
            } else {
                $('.address').removeClass('active');
                return true;
            }
        }
        $('.user').on('blur', '.user-name', function() {
            verifyUser();
        })
        $('.tell').on('blur', '.tell-info', function() {
            verifyTell();
        })
        $('.address').on('blur', '.add-info', function() {
                verifyAddr();
            })
            //判断验证是否通过
        $('footer').on('touchend', function() {
            var name = $('.user-name').val();
            var cell = $('.tell-info').val();
            var province = $('#cmbProvince').val();
            var city = $('#cmbCity').val();
            var area = $('#cmbArea').val();
            var pro = province + city + area;
            var address = $('.add-info').val();
            var obj = {};
            obj.name = name;
            obj.cell = cell;
            obj.pro = pro;
            obj.address = address;
            var userInfo = JSON.stringify(obj);
            sessionStorage.removeItem('userInfo');
            sessionStorage.setItem('userInfo', userInfo);
            if (verifyUser() && verifyTell() && verifyAddr()) {
                window.location.href = 'order.html?add'
            }
        })

        // 纯JS省市区三级联动
        var addressInit = function(_cmbProvince, _cmbCity, _cmbArea, defaultProvince, defaultCity, defaultArea) {
            var cmbProvince = document.getElementById(_cmbProvince);
            var cmbCity = document.getElementById(_cmbCity);
            var cmbArea = document.getElementById(_cmbArea);

            function cmbSelect(cmb, str) {
                for (var i = 0; i < cmb.options.length; i++) {
                    if (cmb.options[i].value == str) {
                        cmb.selectedIndex = i;
                        return;
                    }
                }
            }

            function cmbAddOption(cmb, str, obj) {
                var option = document.createElement("OPTION");
                cmb.options.add(option);
                option.innerText = str;
                option.value = str;
                option.obj = obj;
            }

            function changeCity() {
                cmbArea.options.length = 0;
                if (cmbCity.selectedIndex == -1) return;
                var item = cmbCity.options[cmbCity.selectedIndex].obj;
                for (var i = 0; i < item.prefectureList.length; i++) {
                    cmbAddOption(cmbArea, item.prefectureList[i].name, null);
                }
                cmbSelect(cmbArea, defaultArea);
            }

            function changeProvince() {
                cmbCity.options.length = 0;
                cmbCity.onchange = null;
                if (cmbProvince.selectedIndex == -1) return;
                var item = cmbProvince.options[cmbProvince.selectedIndex].obj;
                for (var i = 0; i < item.cityList.length; i++) {
                    cmbAddOption(cmbCity, item.cityList[i].name, item.cityList[i]);
                }
                cmbSelect(cmbCity, defaultCity);
                changeCity();
                cmbCity.onchange = changeCity;
            }

            for (var i = 0; i < provinceList.length; i++) {
                cmbAddOption(cmbProvince, provinceList[i].name, provinceList[i]);
            }
            cmbSelect(cmbProvince, defaultProvince);
            changeProvince();
            cmbProvince.onchange = changeProvince;
        };
        //cityList 市级  prefectureList 县级
        var provinceList = [{
            "code": "11",
            "name": "北京市",
            "cityList": [{
                "code": "1101",
                "name": "市辖区",
                "prefectureList": [{
                    "code": "110101",
                    "name": "东城区"
                }]
            }]
        }];
        addressInit('cmbProvince', 'cmbCity', 'cmbArea');
    })
</script>

</html>